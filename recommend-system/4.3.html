<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.3-用户行为序列建模 | 阿药算法</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="打通算法面试任督二脉">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.fe6dc972.css" as="style"><link rel="preload" href="/assets/js/app.8518e532.js" as="script"><link rel="preload" href="/assets/js/3.01b1ada6.js" as="script"><link rel="preload" href="/assets/js/1.f343df0c.js" as="script"><link rel="preload" href="/assets/js/59.a2542f17.js" as="script"><link rel="prefetch" href="/assets/js/10.8f5f369f.js"><link rel="prefetch" href="/assets/js/100.316e5ee5.js"><link rel="prefetch" href="/assets/js/101.fad72190.js"><link rel="prefetch" href="/assets/js/102.c8654f67.js"><link rel="prefetch" href="/assets/js/103.0ef90d2e.js"><link rel="prefetch" href="/assets/js/104.74905eda.js"><link rel="prefetch" href="/assets/js/105.88b053eb.js"><link rel="prefetch" href="/assets/js/106.07e74ccb.js"><link rel="prefetch" href="/assets/js/107.6cf4888b.js"><link rel="prefetch" href="/assets/js/108.088d9ab7.js"><link rel="prefetch" href="/assets/js/109.81b513ba.js"><link rel="prefetch" href="/assets/js/11.3a9d991e.js"><link rel="prefetch" href="/assets/js/110.4405687c.js"><link rel="prefetch" href="/assets/js/111.84f52e51.js"><link rel="prefetch" href="/assets/js/112.0835627e.js"><link rel="prefetch" href="/assets/js/113.f52a64f8.js"><link rel="prefetch" href="/assets/js/114.78c71883.js"><link rel="prefetch" href="/assets/js/115.1bc75f87.js"><link rel="prefetch" href="/assets/js/116.23247ca8.js"><link rel="prefetch" href="/assets/js/117.c2a03d05.js"><link rel="prefetch" href="/assets/js/118.06a99a45.js"><link rel="prefetch" href="/assets/js/119.02819cc6.js"><link rel="prefetch" href="/assets/js/12.ead6404b.js"><link rel="prefetch" href="/assets/js/120.4c7f544e.js"><link rel="prefetch" href="/assets/js/121.17af8971.js"><link rel="prefetch" href="/assets/js/122.b2d58f28.js"><link rel="prefetch" href="/assets/js/123.cd824d89.js"><link rel="prefetch" href="/assets/js/124.8ba0617f.js"><link rel="prefetch" href="/assets/js/125.dae1d43d.js"><link rel="prefetch" href="/assets/js/126.766c680b.js"><link rel="prefetch" href="/assets/js/127.0ba89f98.js"><link rel="prefetch" href="/assets/js/13.3f47e407.js"><link rel="prefetch" href="/assets/js/14.4214c90a.js"><link rel="prefetch" href="/assets/js/15.d8b35316.js"><link rel="prefetch" href="/assets/js/16.5c3cca68.js"><link rel="prefetch" href="/assets/js/17.b1afd92a.js"><link rel="prefetch" href="/assets/js/18.5d5af7f0.js"><link rel="prefetch" href="/assets/js/19.dff93588.js"><link rel="prefetch" href="/assets/js/20.84b24def.js"><link rel="prefetch" href="/assets/js/21.fddc8d57.js"><link rel="prefetch" href="/assets/js/22.a2256c87.js"><link rel="prefetch" href="/assets/js/23.e99271f0.js"><link rel="prefetch" href="/assets/js/24.6f57ed45.js"><link rel="prefetch" href="/assets/js/25.f94e1138.js"><link rel="prefetch" href="/assets/js/26.95703874.js"><link rel="prefetch" href="/assets/js/27.862053ac.js"><link rel="prefetch" href="/assets/js/28.484b0f92.js"><link rel="prefetch" href="/assets/js/29.a6bc4696.js"><link rel="prefetch" href="/assets/js/30.899ae475.js"><link rel="prefetch" href="/assets/js/31.c0692275.js"><link rel="prefetch" href="/assets/js/32.f432af29.js"><link rel="prefetch" href="/assets/js/33.53298676.js"><link rel="prefetch" href="/assets/js/34.8453251e.js"><link rel="prefetch" href="/assets/js/35.4ad02f32.js"><link rel="prefetch" href="/assets/js/36.e2020b55.js"><link rel="prefetch" href="/assets/js/37.bd0d762c.js"><link rel="prefetch" href="/assets/js/38.28b40e69.js"><link rel="prefetch" href="/assets/js/39.2a062550.js"><link rel="prefetch" href="/assets/js/4.bd6af1c3.js"><link rel="prefetch" href="/assets/js/40.26b798f5.js"><link rel="prefetch" href="/assets/js/41.d4a79f05.js"><link rel="prefetch" href="/assets/js/42.d7d3e46f.js"><link rel="prefetch" href="/assets/js/43.dd97af95.js"><link rel="prefetch" href="/assets/js/44.d80ed9c3.js"><link rel="prefetch" href="/assets/js/45.0160eb21.js"><link rel="prefetch" href="/assets/js/46.e1745185.js"><link rel="prefetch" href="/assets/js/47.fffc13d4.js"><link rel="prefetch" href="/assets/js/48.36febb98.js"><link rel="prefetch" href="/assets/js/49.af73c65e.js"><link rel="prefetch" href="/assets/js/5.d40f878d.js"><link rel="prefetch" href="/assets/js/50.7d54afcb.js"><link rel="prefetch" href="/assets/js/51.f16113b0.js"><link rel="prefetch" href="/assets/js/52.81185856.js"><link rel="prefetch" href="/assets/js/53.68720d69.js"><link rel="prefetch" href="/assets/js/54.e8342836.js"><link rel="prefetch" href="/assets/js/55.8b4a107b.js"><link rel="prefetch" href="/assets/js/56.ce0dfd6e.js"><link rel="prefetch" href="/assets/js/57.05e76878.js"><link rel="prefetch" href="/assets/js/58.ba13d18b.js"><link rel="prefetch" href="/assets/js/6.12f07f50.js"><link rel="prefetch" href="/assets/js/60.400d49b9.js"><link rel="prefetch" href="/assets/js/61.52a7d43a.js"><link rel="prefetch" href="/assets/js/62.33129860.js"><link rel="prefetch" href="/assets/js/63.23ce5a1c.js"><link rel="prefetch" href="/assets/js/64.eddafc14.js"><link rel="prefetch" href="/assets/js/65.56733127.js"><link rel="prefetch" href="/assets/js/66.74b3800e.js"><link rel="prefetch" href="/assets/js/67.6d78b237.js"><link rel="prefetch" href="/assets/js/68.4e75b203.js"><link rel="prefetch" href="/assets/js/69.fb86f086.js"><link rel="prefetch" href="/assets/js/7.4a995ca6.js"><link rel="prefetch" href="/assets/js/70.5e4eeed1.js"><link rel="prefetch" href="/assets/js/71.1d58b2eb.js"><link rel="prefetch" href="/assets/js/72.0db49304.js"><link rel="prefetch" href="/assets/js/73.8559ae22.js"><link rel="prefetch" href="/assets/js/74.1d9b18d8.js"><link rel="prefetch" href="/assets/js/75.533946ea.js"><link rel="prefetch" href="/assets/js/76.c3db5bcc.js"><link rel="prefetch" href="/assets/js/77.dbbaad4f.js"><link rel="prefetch" href="/assets/js/78.3249bf8c.js"><link rel="prefetch" href="/assets/js/79.0e1f4de7.js"><link rel="prefetch" href="/assets/js/8.65dc42f1.js"><link rel="prefetch" href="/assets/js/80.cb0e11ca.js"><link rel="prefetch" href="/assets/js/81.56378651.js"><link rel="prefetch" href="/assets/js/82.cc47393e.js"><link rel="prefetch" href="/assets/js/83.e3587b1d.js"><link rel="prefetch" href="/assets/js/84.a2ccc99a.js"><link rel="prefetch" href="/assets/js/85.ecbf6f01.js"><link rel="prefetch" href="/assets/js/86.e6c7c417.js"><link rel="prefetch" href="/assets/js/87.ac1f2e2e.js"><link rel="prefetch" href="/assets/js/88.5238dd17.js"><link rel="prefetch" href="/assets/js/89.c11c295e.js"><link rel="prefetch" href="/assets/js/9.9cecf183.js"><link rel="prefetch" href="/assets/js/90.c9f297b4.js"><link rel="prefetch" href="/assets/js/91.97568d6a.js"><link rel="prefetch" href="/assets/js/92.c9a4b860.js"><link rel="prefetch" href="/assets/js/93.71530ed1.js"><link rel="prefetch" href="/assets/js/94.098fe0b7.js"><link rel="prefetch" href="/assets/js/95.cf5a1bd5.js"><link rel="prefetch" href="/assets/js/96.1aa633ad.js"><link rel="prefetch" href="/assets/js/97.e19d2c4e.js"><link rel="prefetch" href="/assets/js/98.2c1dfac1.js"><link rel="prefetch" href="/assets/js/99.a951db26.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fe6dc972.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>阿药算法</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>打通算法面试任督二脉</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>阿药</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="阿药算法" class="logo"> <span class="site-name">阿药算法</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/ml/" class="nav-link"><i class="fa fa-laptop-code"></i>
  机器学习
</a></div><div class="nav-item"><a href="/recommend-system/" class="nav-link router-link-active"><i class="fa fa-assistive-listening-systems"></i>
  推荐系统
</a></div><div class="nav-item"><a href="/nlp/" class="nav-link"><i class="fa fa-language"></i>
  自然语言处理
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link"><i class="fa fa-file-code"></i>
  Leetcode
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/tddJF6sPAsDf1psqwfXHlg" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-wechat"></i>
  公众号
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/zhang-hua-28-4" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    阿药
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>117</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>69</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/ml/" class="nav-link"><i class="fa fa-laptop-code"></i>
  机器学习
</a></div><div class="nav-item"><a href="/recommend-system/" class="nav-link router-link-active"><i class="fa fa-assistive-listening-systems"></i>
  推荐系统
</a></div><div class="nav-item"><a href="/nlp/" class="nav-link"><i class="fa fa-language"></i>
  自然语言处理
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link"><i class="fa fa-file-code"></i>
  Leetcode
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/tddJF6sPAsDf1psqwfXHlg" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-wechat"></i>
  公众号
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/zhang-hua-28-4" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>一、推荐系统概览</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/1.1.html" class="sidebar-link">1.1-概览</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>二、特征工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/2.1.html" class="sidebar-link">2.1-特征提取</a></li><li><a href="/recommend-system/2.2.html" class="sidebar-link">2.2-处理数值特征</a></li><li><a href="/recommend-system/2.3.html" class="sidebar-link">2.3-处理类别特征</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>三、Embedding</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/3.1.html" class="sidebar-link">3.1-Embedding介绍</a></li><li><a href="/recommend-system/3.2.html" class="sidebar-link">3.2-Embedding的共享与独占</a></li><li><a href="/recommend-system/3.3.html" class="sidebar-link">3.3-参数服务器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>四、精排</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/4.1.html" class="sidebar-link">4.1-交叉结构</a></li><li><a href="/recommend-system/4.2.html" class="sidebar-link">4.2-Transformer</a></li><li><a href="/recommend-system/4.3.html" aria-current="page" class="active sidebar-link">4.3-用户行为序列建模</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>五、召回</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/5.1.html" class="sidebar-link">5.1-传统召回</a></li><li><a href="/recommend-system/5.2.html" class="sidebar-link">5.2-向量化召回</a></li><li><a href="/recommend-system/5.3.html" class="sidebar-link">5.3-FM召回</a></li><li><a href="/recommend-system/5.4.html" class="sidebar-link">5.4-双塔召回</a></li><li><a href="/recommend-system/5.5.html" class="sidebar-link">5.5-GCN召回</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>六、粗排与重排</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/6.1.html" class="sidebar-link">6.1-粗排</a></li><li><a href="/recommend-system/6.2.html" class="sidebar-link">6.2-重排</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>七、多目标与多场景</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/7.1.html" class="sidebar-link">7.1-多目标</a></li><li><a href="/recommend-system/7.2.html" class="sidebar-link">7.2-多场景</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>八、冷启动</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/8.1.html" class="sidebar-link">8.1-</a></li><li><a href="/recommend-system/8.2.html" class="sidebar-link">8.2-对比学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>九、评估与调试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/recommend-system/9.1.html" class="sidebar-link">9.1-离线评估</a></li><li><a href="/recommend-system/9.2.html" class="sidebar-link">9.2-在线评估</a></li><li><a href="/recommend-system/9.3.html" class="sidebar-link">9.3-线上线下一致性</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>4.3-用户行为序列建模</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>阿药</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">4.3-用户行为序列建模</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>阿药</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>8/2/2021</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/recommend-system/4.3.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h3 id="你在建模行为序列中的每个元素时-一般会包含哪些信息"><a href="#你在建模行为序列中的每个元素时-一般会包含哪些信息" class="header-anchor">#</a> 你在建模行为序列中的每个元素时，一般会包含哪些信息？</h3> <p>以&quot;用户最近观看的50个视频&quot;这个序列为例。序列中每个元素的Embedding, 一般由以下几个部分拼接组成:</p> <ul><li>由每个视频的ID进行Embedding得到的向量。</li> <li>时间差信息：计算观看该视频的时刻距离本次请求时刻之间的时间差，将这个时间差桶化成一个整数，再Embedding。这个时间差信息非常重要，序列中不同元素之间的相互影响，历史序列元素对当前候选物料之间的影响，肯定是随着彼此间隔时间而衰减的，因此我们必须将如此重要的信息喂入模型，方便模型刻画时间衰减。</li> <li>以上两点是每个序列元素最重要的信息。除此之外，还可以加入观看视频的一些元信息（e.g， 视频的作者、来源、分类、标签等）  和动作的程度（e.g， 观看时长、观看完成度）</li></ul> <h3 id="有哪些常用的pooling方法可以用于对用户行为序列进行压缩"><a href="#有哪些常用的pooling方法可以用于对用户行为序列进行压缩" class="header-anchor">#</a> 有哪些常用的pooling方法可以用于对用户行为序列进行压缩？</h3> <p>将一个用户的行为序列压缩成一个兴趣向量，最简单的方法就是进行如下按位（element-wise）操作：</p> <ul><li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="P"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="l"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c=":"></mjx-c></mjx-mo><mjx-msub space="4"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-munder space="4" limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-munder><mjx-TeXAtom space="2"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-TeXAtom></mjx-math></mjx-container></li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="P"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="l"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c=":"></mjx-c></mjx-mo><mjx-msub space="4"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mn size="s" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mi size="s" class="mjx-i"><mjx-c c="N"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-munder space="2" limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-munder><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="W"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="P"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="l"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c=":"></mjx-c></mjx-mo><mjx-msub space="4"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mn size="s" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mi size="s" class="mjx-i"><mjx-c c="N"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-msub space="2"><mjx-mo noIC="true" class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>。权重<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>根据时间差或动作程度计算。比如某个历史上观看过的视频，观看的时间距离当前时间越近，观看完成度越高，就越能反映用户兴趣，权重<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>就应该越大。</li></ul> <p>简单Pooling提取出来的用户兴趣是固定的，不像接下来介绍的方法那样，能够随当前候选物料而变化。对于精排，这当然是个缺点。但是对于召回、粗排这种用户、物料必须解耦建模的场景，反正提取用户兴趣时也拿不到候选物料信息，简单Pooling仍然是最常见的选择。</p> <h3 id="简单pooling存在什么问题"><a href="#简单pooling存在什么问题" class="header-anchor">#</a> 简单Pooling存在什么问题？</h3> <p>简单Pooling的问题在于它将序列中的所有元素一视同仁，而在现实中，不同历史记忆对当下决策的影响程度并不相同。举个例子，一个用户过去买过泳衣和iPhone手机。</p> <ul><li>当被展示的商品是游泳镜时，用户是否点击，更多是出于他对买过泳衣的历史记忆。</li> <li>当被展示蓝牙耳机时，过去购买iPhone的历史记忆将主导他此次是否会点击。换句话说，从用户行为序列中提取出来的兴趣向量，应该随当前候选物料的变化而变化，实现&quot;千物千面&quot;的效果</li></ul> <h3 id="din的建模思路是怎样的-怎么理解-千物千面"><a href="#din的建模思路是怎样的-怎么理解-千物千面" class="header-anchor">#</a> DIN的建模思路是怎样的？怎么理解“千物千面”？</h3> <h3 id="用户对于商品的兴趣有哪些特点-din是如何去捕捉用户兴趣的这些特点的"><a href="#用户对于商品的兴趣有哪些特点-din是如何去捕捉用户兴趣的这些特点的" class="header-anchor">#</a> 用户对于商品的兴趣有哪些特点？DIN是如何去捕捉用户兴趣的这些特点的？</h3> <p>多样性（Diversity）：用户在访问电商网站时会对多种商品都感兴趣。也就是用户的兴趣非常的广泛，例如从一个年轻妈妈的历史行为中，可以看到她的兴趣非常广泛：羊毛衫、帆布包、耳环、童装、奶粉等等。<br>局部聚焦（Local Activation）：即用户是否会点击推荐给他的某一件商品，往往是基于他之前的部分兴趣，而非所有兴趣。例如，对一个热爱游泳与吃零食的用户，推荐给他一个泳镜，他是否会点击与他之前购买过泳裤、泳衣等行为相关，但与他之前买过冰淇淋、旺仔牛仔等行为无关。<br>DIN针对当前候选广告局部地激活用户的历史兴趣，赋予和候选广告相关的历史兴趣更高的weight，从而实现Local Activation，而weight的多样性同时也实现了用户兴趣的多样性表达。</p> <h3 id="对于用户兴趣的捕捉-我们一般有哪些方法"><a href="#对于用户兴趣的捕捉-我们一般有哪些方法" class="header-anchor">#</a> 对于用户兴趣的捕捉，我们一般有哪些方法？</h3> <ol><li>平等考虑所有的用户行为，对应到模型中就是使用average pooling层把用户交互过的所有商品的embedding向量取均值，从而得到用户向量。</li> <li>按时间对用户做time decay，加大近期行为影响权重，具体在做average pooling的时候按时间调整权重</li> <li>采用注意力机制，就是对不同行为特征赋予不同weight，这样某些weight高的特征便会主导这一次的预测，就好像模型对这些特征pay attention。</li></ol> <h3 id="din的输入是怎么处理的"><a href="#din的输入是怎么处理的" class="header-anchor">#</a> DIN的输入是怎么处理的？</h3> <p>对于单值离散特征，经过Embedding Layer得到Embedding Vector。<br>对于多值离散特征，先经过一个Embedding Layer，后面增加一个Pooling Layer。Pooling可以用sum或average。最终得到一个固定长度的Embedding Vector，这是用户兴趣的一个抽象表示，常被称作User Representation，会损失一些信息。</p> <h3 id="din的激活单元是如何设计的"><a href="#din的激活单元是如何设计的" class="header-anchor">#</a> DIN的激活单元是如何设计的？</h3> <p>DIN会计算候选广告与用户最近N个历史行为商品的相关性权重weight，将其作为加权系数来对这N个行为商品的embeddings做sum pooling，用户兴趣正是由这个加权求和后的embedding来体现。具体地，AU 内部是一个简单的多层网络，输入是候选广告的embedding、历史行为商品的embedding、以及两者的叉乘。具体如下红框所示：</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gqdkibmi5wj31a40p4tbl.jpg#id=wN2N8&amp;originHeight=904&amp;originWidth=1660&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""><br>至于为什么增加叉乘作为输入？是因为两个embedding的叉乘是显示地反映了两者之间的相关性，加入后有助于更好学习weight。论文初版使用的是两个embedding差，经过了一系列的尝试和实验对比，才转为使用叉乘。<br>作者也尝试过 LSTM 结构实现AU，效果并不理想。理由是文本是在语法严格约束下的有序序列，而用户历史行为序列可能包含了多个同时存在的用户兴趣点，用户会在这些兴趣点之间“随意切换”，这使得这个序列并不是那么严格的“有序”，会产生一些噪声。</p> <h3 id="din中使用激活函数dice替代经典的prelu激活函数-优势是什么"><a href="#din中使用激活函数dice替代经典的prelu激活函数-优势是什么" class="header-anchor">#</a> DIN中使用激活函数Dice替代经典的PReLU激活函数，优势是什么？</h3> <p>PRelu是很常见的激活函数，其固定的折点（hard rectified point）是0：<br>f(s)=\begin{cases}  s ,\quad  if \quad s&gt;0\\ \alpha s,\quad if \quad s≤0 \\  \end{cases} = p(s)s+(1-p(s))\alpha s<br>其中指示函数<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="&gt;"></mjx-c></mjx-mo><mjx-mn space="4" class="mjx-n"><mjx-c c="0"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container><br>论文对PRelu做了改进，使得曲线中间部分光滑变化，其中光滑的方式与数据分布有关：<br><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="f"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">，</mjx-utext></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mn size="s" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-msup><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.888em;"><mjx-TeXAtom size="s"><mjx-mo class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-msqrt><mjx-sqrt><mjx-surd><mjx-mo class="mjx-sop"><mjx-c c="221A"></mjx-c></mjx-mo></mjx-surd><mjx-box style="padding-top:0.063em;"><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="3B5"></mjx-c></mjx-mi></mjx-box></mjx-sqrt></mjx-msqrt></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-TeXAtom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container><br>常数<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3B5"></mjx-c></mjx-mi></mjx-math></mjx-container>在文中取<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msup><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c><mjx-c c="0"></mjx-c></mjx-mn><mjx-script style="vertical-align:0.393em;"><mjx-TeXAtom size="s"><mjx-mo class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="8"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-msup></mjx-math></mjx-container><br>训练时，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container>和<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container>是当前mini-batch的均值和方差。在测试时，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container>和<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container>通过常见的moving average计算，论文中moving average超参数取0.99.<br><img src="https://tva1.sinaimg.cn/large/008i3skNly1gqehnq5nluj30sc0as74h.jpg#id=tKWJz&amp;originHeight=388&amp;originWidth=1020&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""><br>Dice的主要动机是随数据分布变化动态地调整 rectified point，虽说是动态调整，其实它也把rectified point限定在了数据均值 ，实验显示对本文的应用场景Dice比PRelu效果更好。</p> <h3 id="din使用了一种自适应正则-它的动机是什么"><a href="#din使用了一种自适应正则-它的动机是什么" class="header-anchor">#</a> DIN使用了一种自适应正则，它的动机是什么？</h3> <p>使用自适应正则的出发点在于，使用的特征具有显著的“长尾效应”，即很多feature id只出现了几次，只有小部分feature id出现多次，这在训练过程中增加了很多噪声，并且加重了过拟合。<br>正则化是处理过拟合的常见技巧，但正则方法在稀疏数据深度学习上的使用，还没有一个公认的好方法。论文使用的特征具有显著的稀疏性，对绝大部分样本来说，很多特征都是0，只有很小一部分特征非0。但直接使用正则，不管特征是不是0都是要正则的，要梯度计算。对大规模的稀疏特征，参数规模也非常庞大（最大头的参数来源就是embedding），这种计算量是不可接受的。<br>论文提出了自适应正则，即每一次mini-batch，只在非0特征对应参数上计算L2正则（针对特征稀疏性），且正则强度与特征频次有关，频次越高正则强度越低，反之越高（针对特征长尾效应）。例如，在第m次mini-batch训练，对第 j 个特征的embedding向量<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>的梯度更新：<br><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="2190"></mjx-c></mjx-mo><mjx-msub space="4"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3B7"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mfrac><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mn size="s" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-c c="|"></mjx-c></mjx-mo><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="|"></mjx-c></mjx-mo></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-munder space="2" limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-TeXAtom size="s"><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="y"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="2208"></mjx-c></mjx-mo><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-TeXAtom></mjx-script></mjx-munder><mjx-mfrac space="2"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-mi class="mjx-n"><mjx-c c="2202"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="y"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-mi class="mjx-n"><mjx-c c="2202"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3BB"></mjx-c></mjx-mi><mjx-mfrac><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-msub size="s"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-msub size="s"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container><br>其中<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>表示第<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-math></mjx-container>次mini-batch的数据集，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>表示特征<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-math></mjx-container>在整个训练集<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi></mjx-math></mjx-container>中出现的频次。<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="2208"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="{"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="0"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mn space="2" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c="}"></mjx-c></mjx-mo></mjx-math></mjx-container>表示<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>中是否至少有一个样本的特征<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-math></mjx-container>取值为1，正则参数<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3BB"></mjx-c></mjx-mi></mjx-math></mjx-container>在论文中取0.01.</p> <h3 id="din论文中使用了gauc作为评价指标-它的好处是什么"><a href="#din论文中使用了gauc作为评价指标-它的好处是什么" class="header-anchor">#</a> DIN论文中使用了GAUC作为评价指标，它的好处是什么？</h3> <p>AUC表示正样本得分比负样本得分高的概率。在CTR实际应用场景中，CTR预测常被用于对每个用户候选广告的排序。但是不同用户之间存在差异：有些用户天生就是点击率高。以往的评价指标对样本不区分用户地进行AUC的计算。<br>论文采用的GAUC实现了用户级别的AUC计算，在单个用户AUC的基础上，按照点击次数或展示次数进行加权平均，消除了用户偏差对模型的影响，更准确的描述了模型的表现效果：</p> <p><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="G"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="C"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-munderover limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-spacer style="margin-top:0.284em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-munderover><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="2217"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="C"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-munderover limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-spacer style="margin-top:0.284em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-munderover><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-munderover limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-spacer style="margin-top:0.284em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-munderover><mjx-mi space="2" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="2217"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="C"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-munderover limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-spacer style="margin-top:0.284em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-munderover><mjx-mi space="2" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></p> <p>其中权重w既可以是展示次数(impression)也可以是点击次数(clicks)。n是用户数量。</p> <h3 id="如果想在召回或粗排中建模用户长序列-怎么做"><a href="#如果想在召回或粗排中建模用户长序列-怎么做" class="header-anchor">#</a> 如果想在召回或粗排中建模用户长序列，怎么做？</h3> <p>DIN中的Attention需要拿候选物料t当Query，这在召回、粗排这些要求用户、物料解耦建模的场景是做不到的。这时，可以尝试拿用户行为序列中的最后一个物料当Query对整个行为序列Attention。 毕竟最后的行为反映用户最近的兴趣，可以当尺子衡量序列中其他历史物料的重要性。</p> <h3 id="为什么序列内的依赖关系是重要的-如何建模"><a href="#为什么序列内的依赖关系是重要的-如何建模" class="header-anchor">#</a> 为什么序列内的依赖关系是重要的？如何建模？</h3> <p>DIN实现了用户兴趣的&quot;千物千面&quot;，但是仍有不足，就是它只刻画了候选物料与序列元素的交叉，却忽略了行为序列内部各元素之间的依赖关系。比如一个用户购买过MacBok和iPad，这两个历史行为的组合将产生非常强烈的信号，但是这种序列内部的交叉组合却末能在DIN中体现。为此，业界提出了一系列模型，使从行为序列中提取出来的用户兴趣向量，既能反映候选物料与历史记忆之间的相关性，又能反映不同历史记忆之间的依赖性。</p> <p>第一步，用Multi-Head Self-Attention建模行为序列内部的依赖关系。Multi-Head Self-Attention的结果是一个与原始序列相同长度的新序列，新序列中的每个元素都以不同方式（i.e.，Multi-Head）融合了原始序列中其他物料的信息。<br>还举上面的例子，在原始用户行为序列中，&quot;购买过Macbook&quot;这一历史行为反映的只是单次购买本身。而对行为序列Self-Attention之后，同样的历史行为不仅反映了本次购买，还体现了2天前用户还购买过iPhone，和1天后用户又购买了iPad。通过与前后历史行为的交叉、关联，一个苹果忠实粉丝的形象跃然纸上。就这样，底层提取出来的用户兴趣的质量得以提高，上层的CTR建模自然也就降低了难度。<br>这里还可以像Transformer那样，叠加多层Self_Attention建模更深的特征交叉，但是那样做的计算开销也更大，通常一层Self-Attention足矣。</p> <p>第二步，用当前候选物料和Self-Attention产生的新序列上套用DIN，建模候选物料与历史行为序列之间的相<br>关性，得到最终的用户兴趣向量。</p> <h3 id="计算一下target-attention的时间复杂度-self-attention的时间复杂度"><a href="#计算一下target-attention的时间复杂度-self-attention的时间复杂度" class="header-anchor">#</a> 计算一下Target Attention的时间复杂度，Self-Attention的时间复杂度</h3> <p>假设一个batch的大小为B，用户行为序列的长度为L，序列中每个Embedding的长度为d</p> <ul><li>DIN中，拿候选物料当Query对整个序列做Attention时，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">复</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">杂</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">度</mjx-utext><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="O"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container></li> <li>双层Attention中，用户行为序列内部做Self-Attention的<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">复</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">杂</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">度</mjx-utext><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="O"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mi class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.363em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container>，所以，Attention的建模方式的时间复杂度，与用户行为序列的长度呈线性甚至平方的关系，在L较小的时候还算可行，而当L非常大的时候，是无法满足在线预测与训练更新的实时性要求的。</li></ul> <p>而推荐系统是有对用户长期行为序列建模的需求的。因为如果建模的序列太短，其中难免会包含一些用户临时起意的行为，算是一种噪声。另外，太短的行为序列也无法反映用户的一些周期性行为，比如每周、每月的习惯性采购。</p> <h3 id="每到-双十一-之类的促销季-用户的购买行为与他之前短期行为有较大不同-应该如何建模"><a href="#每到-双十一-之类的促销季-用户的购买行为与他之前短期行为有较大不同-应该如何建模" class="header-anchor">#</a> 每到“双十一”之类的促销季，用户的购买行为与他之前短期行为有较大不同，应该如何建模？</h3> <p>DIN是拿候选物料t对行为序列<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mo class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mo space="2" class="mjx-n"><mjx-c c="22EF"></mjx-c></mjx-mo><mjx-mo space="2" class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="H"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container>做<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi></mjx-math></mjx-container>。 和<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi></mjx-math></mjx-container>相似的历史物料<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>，权重会高一些，反之，权重会低。这里的Attention相当于对历史行为序列做&quot;软过滤&quot;。之前说过了，它的时间复杂度与序列长度L成线性关系。<br>既然在长序列上做Attention软过滤的代价太大，就干脆直接上硬过滤。在长序列中筛选（搜索)出与候选物料相关的一个短序列(一般长度在200以下)，称为Sub user Behavior Sequence (SBS)。这个硬过滤的过程就是原文中的General Search Unit (GSU)。<br>由于长度大大缩短（万级→百级)，在SBS再套用DIN就变得可行。拿候选物料t和SBS做Attention,加权平均后的结果就是用户长期兴趣的向量表达。这个过程就是原文中的Exact Search Unit (ESU)<br>而根据在General Search Unit中如何搜索，SIM又有Hard Search和Soft Search两种实现方式。</p> <h3 id="请简要讲述一下sim中的hard-search是怎么回事"><a href="#请简要讲述一下sim中的hard-search是怎么回事" class="header-anchor">#</a> 请简要讲述一下SIM中的Hard Search是怎么回事？</h3> <p>所谓HardSearch，就是拿候选物料t的某个属性（比如，物料分类或标签），在用户完整的长期历史中搜索与其有相同属性的历史物料，组成SBS。比如当前候选物料是一件衣服，SIM将该用户过去所有购买过的衣服挑选出来，组成针对这个候选物料的SBS。<br>当然，真正的搜索过程，不可能为每个候选物料都把用户全部历史都遍历一遍。为了加速这一过程，阿里特别设计了User BehaviorTree（UBT）数据库，将每个用户的长期行为序列，&quot;分门别类&quot;地缓存起来。UBT的结构如图4-11所示，类似一个双层的HashMap。</p> <ul><li>外层HashMap的key是UserId。</li> <li>内层HashMap的key就是某个属性（比如，物料分类）。</li> <li>内层HashMap的value就是某个用户在某个属性下的SBS。</li></ul> <p>这样一来，通过两层哈希查找，模型就能当前用户针对当前候选物料的SBS，效率足以满足线上预测与训练<br>的需要。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/13009966/1690723695272-c851be5c-31df-41c5-b4d8-0c8f86c3efbc.png#averageHue=%23f4f4f4&amp;clientId=u2f561b2e-b44b-4&amp;from=paste&amp;height=266&amp;id=u7054caff&amp;originHeight=266&amp;originWidth=602&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=102055&amp;status=done&amp;style=none&amp;taskId=uf811b1aa-0c56-4812-916a-6643e084b31&amp;title=&amp;width=602" alt="image.png"></p> <h3 id="请简要讲述一下sim中的soft-search是怎么回事"><a href="#请简要讲述一下sim中的soft-search是怎么回事" class="header-anchor">#</a> 请简要讲述一下SIM中的Soft Search是怎么回事？</h3> <p>Hard Search是拿物料属性进行精确匹配，不如用Embedding进行&quot;模糊查找&quot;的扩展性好。于是，很自然想到用候选物料的ltem Embedding,在用户长期行为序列中通过&quot;近似近邻搜索算法&quot;(Approximate Nearest Neighbors,ANN)，查找与之距离最近的前K个历史物料，组成SBS，这就是所谓的Sot Search。<br>至于ltem Embedding从何而来？原论文里，是只用候选物料和长期行为序列，构建了-个小模型预测CTR。模型训练完成后的复产品就是ltem Embedding。除此之外，用双塔召回粗排得到的Item Embedding行不行？用Word2vec算法套用在长期行为序列上得到的ltem Embedding，行不行？笔者觉得，理论上是没毛病的，都可以试一试，让离线指标和在线A/B testing的结果来告诉我们具体用哪种是最好的。<br>值得注意的是，SIM的论文里指出，用户长短期行为历史的数据分布差异较大，建模用户短期行为序列的ltem Embedding，不宜复用于建模用户长期行为序列。也就是说，同一个物料在用于建模用户长期兴趣与短期兴趣时，应该对应完全不同的ltem Embedding。基于同样的原因，如果你想用双塔模型的Item Embedding来进行Soft Search，你的双塔模型最好也拿长期行为序列来训练。如果嫌序列太长，拖慢双塔的速度，可以对长序列进行采样。<br>得到的Item Embedding之后，要喂入Faiss[22]这样的向量数据库，离线建立好索引(Search Index)， 以加速线上预测和训练时的SoftSearch.<br><img src="https://cdn.nlark.com/yuque/0/2023/png/13009966/1690724285886-351665b5-18f5-473c-8be5-e1df428335a4.png#averageHue=%23f8f5f0&amp;clientId=u2f561b2e-b44b-4&amp;from=paste&amp;height=348&amp;id=u67ee7ca3&amp;originHeight=348&amp;originWidth=614&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=158612&amp;status=done&amp;style=none&amp;taskId=u92f4a711-7170-4405-aeb2-a5cb78debb0&amp;title=&amp;width=614" alt="image.png"></p> <h3 id="sim这种强而重的模型有什么局限-有什么改进方案吗"><a href="#sim这种强而重的模型有什么局限-有什么改进方案吗" class="header-anchor">#</a> SIM这种强而重的模型有什么局限？有什么改进方案吗？</h3> <p>虽然SIM模型提取出来的长期用户兴趣有&quot;千物千面”的优点，但其缺点就是实现起来太过复杂，线上预测耗时增加得比较多。需要有工程团队的强有力配合，才能将在线预测和训练更新的耗时，降低到满足实时性要求。即便如此，一次请求中的候选物料也不能太多，因此SIM只适用于精排这种候选集有限的环节。<br>没有阿里那么强的工程架构能力，或者想在召回、粗排阶段引入用户长期兴趣，这时抄不了SIM的作业，怎么办？别急，除了阿里的&quot;在线派&quot;技术路线，我们可以离线将用户的长期兴趣挖掘好，缓存起来供线上模型调用。这种&quot;离线派&quot;技术路线，将费时的&quot;挖掘用户长期兴趣&quot;这一任务由线上转移到线下，省却了优化线上架构的麻烦，实现起来更加简单便捷。<br>一种方法就是人工统计长期兴趣。手工挖掘用户长期兴趣，在某些场合下代替SIM这种&quot;“强但重&quot;的模型。比如，我们可以统计出每个用户针对某个商品分类或视频标签，在过去1周、过去1个月等较长时段内的CTR，代表用户长期兴趣，喂进推荐模型。<br>另一种方法就是离线预训练一个辅助模型，提取用户长期兴趣。其一般流程是：</p> <ul><li>预训练该模型，输入用户长期行为序列，输出一个Embedding代表用户长期兴趣。训练好这个辅助模型之后，将行为序列超过一定长度的用户，都过一遍这个模型。得到代表这些用户长期兴趣的Embedding，存入Redis之类的KV数据库。</li> <li>当线上预测或训练需要用户长期兴趣时，就拿用户的Userld检索Redis，得到代表他的长期兴趣的Embedding，喂入推荐主模型。</li> <li>尽管用户一天之内会频繁动作，但是各用户的长期兴趣向量和生成它们的预训练模型，无须实时更新，只需要每天更新一次即可。因为用户刚刚发生的行为属于短期兴趣的建模范畴，留给DIN、双层Attention等模型去应付足矣。</li></ul> <p>美团建模超长用户行为序列，遵循的就是这种&quot;离线派&quot;技术路线。据说在美团场景下，取得了比SIM更好的效果[24]。<br>至于如何构建这样的预训练模型，一种方法是，用同一个用户的长期行为序列，预测他的短期行为序列，<br>如图所示：</p> <ul><li>模型采用双塔结构</li> <li>喂入模型的样本是一个三元组（<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi space="2" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi space="2" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>）。其中<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>和<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>是个用户A的长期行为序列和短期行为序列，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>是随机采样到的另 一个用户B的短期行为序列。</li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>喂入左塔得到A用户的长期兴趣向量<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>和<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>喂入右塔得到A、 B两用户的短期兴趣向量<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>和<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>.</li> <li>建模目标是，同-用户的长短期兴趣向量应该相近，即<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi space="2" class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">）</mjx-utext></mjx-mo></mjx-math></mjx-container>越大越好；不同用户的长短期向量相距较远，即<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="L"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.153em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi space="2" class="mjx-i"><mjx-c c="U"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="B"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container>越小越好。</li> <li>双塔模型训练好之后，离线将老用户们的长期行为序列喂入左塔，就得到表示各用户长期兴趣的向量。</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/13009966/1690724851550-de42b4a6-3997-4e23-bfbc-19424b1f22c3.png#averageHue=%23eba97a&amp;clientId=u2f561b2e-b44b-4&amp;from=paste&amp;height=348&amp;id=u0c2778a7&amp;originHeight=348&amp;originWidth=512&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=202949&amp;status=done&amp;style=none&amp;taskId=u951bf412-9326-487f-9bea-8e5a665ccb0&amp;title=&amp;width=512" alt="image.png"><br>再次强调，“离线预训练用户长期兴趣&quot;的作法，优点是不会增加线上耗时，实现简单；缺点就是得到的用户长期兴趣，不会随着候选物料而变化，无法做到&quot;千物千面&quot;。离线vs.在线，两种技术路线各有优劣，请读者根据自己的实际情况，权衡选择。</p> <h3 id="每个用户的行为序列长度不同-如何处理-truncate很简单-关键是如何解决padding的问题"><a href="#每个用户的行为序列长度不同-如何处理-truncate很简单-关键是如何解决padding的问题" class="header-anchor">#</a> 每个用户的行为序列长度不同，如何处理？Truncate很简单，关键是如何解决Padding的问题？</h3> <p>不解决的话，两个完全不同的序列，因为被填充的大量的0，而被模型认为相似<br>提示：可以看看TensorFlow Transformer的源码，看看人家是如何解决的？</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/recommend-system/4.2.html" class="prev">
            4.2-Transformer
          </a></span> <span class="next"><a href="/recommend-system/5.1.html">
            5.1-传统召回
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="/assets/js/app.8518e532.js" defer></script><script src="/assets/js/3.01b1ada6.js" defer></script><script src="/assets/js/1.f343df0c.js" defer></script><script src="/assets/js/59.a2542f17.js" defer></script>
  </body>
</html>
